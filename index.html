<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Layout Tool - Combine Multiple Charts into Professional Layouts</title>
    <meta name="description" content="Free tool to combine multiple chart images (PNG, JPG, PDF, TIFF) into professional layouts. Perfect for research papers, presentations, and reports.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📊</text></svg>">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <header>
            <h1>📊 Chart Layout Tool</h1>
            <p class="subtitle">Combine multiple chart images into professional layouts</p>
        </header>
        
        <!-- File Upload -->
        <div class="upload-section">
            <input type="file" id="imageUpload" multiple accept="image/*,.pdf,.tiff,.tif">
            <div class="upload-content">
                <div class="upload-icon">📁</div>
                <p><strong>Upload your chart images</strong></p>
                <p>Supports PNG, JPG, PDF, TIFF • Unlimited files</p>
                <small>Click to browse or drag & drop files here</small>
            </div>
        </div>
        
        <!-- Debug info -->
        <div id="debug" style="display: none;">
            <div class="debug-box">
                <h4>🔧 Debug Info:</h4>
                <p id="debugText">Ready to upload images</p>
            </div>
        </div>
        
        <!-- Uploaded Images List -->
        <div id="uploadedImagesSection" style="display: none;">
            <h3>📁 Uploaded Images <span id="imageCount"></span></h3>
            <p class="section-description">✏️ Click on any label to edit it</p>
            <div id="uploadedImagesList"></div>
        </div>
        
        <!-- Layout Configuration -->
        <div class="layout-config" id="layoutConfig" style="display: none;">
            <h3>📐 Layout Configuration</h3>
            
            <!-- Layout Type Selector -->
            <div class="layout-type-selector">
                <label class="layout-type-option">
                    <input type="radio" name="layoutType" value="auto" checked onchange="updateLayoutType()">
                    <span class="radio-custom"></span>
                    🤖 Auto-fit (recommended)
                </label>
                <label class="layout-type-option">
                    <input type="radio" name="layoutType" value="preset" onchange="updateLayoutType()">
                    <span class="radio-custom"></span>
                    📋 Preset layouts
                </label>
                <label class="layout-type-option">
                    <input type="radio" name="layoutType" value="custom" onchange="updateLayoutType()">
                    <span class="radio-custom"></span>
                    ⚙️ Custom grid
                </label>
            </div>
            
            <!-- Auto Layout Info -->
            <div id="autoLayoutInfo" class="layout-option">
                <div class="info-box">
                    <p>🎯 Automatically calculates the best grid size for your images</p>
                    <p id="autoLayoutDetails" class="layout-details"></p>
                </div>
            </div>
            
            <!-- Preset Layouts -->
            <div id="presetLayouts" class="layout-option" style="display: none;">
                <div class="preset-grid">
                    <button onclick="setLayout(1, 1)" data-layout="1x1">1×1</button>
                    <button onclick="setLayout(2, 1)" data-layout="2x1">2×1</button>
                    <button onclick="setLayout(1, 2)" data-layout="1x2">1×2</button>
                    <button onclick="setLayout(2, 2)" data-layout="2x2">2×2</button>
                    <button onclick="setLayout(3, 1)" data-layout="3x1">3×1</button>
                    <button onclick="setLayout(1, 3)" data-layout="1x3">1×3</button>
                    <button onclick="setLayout(3, 2)" data-layout="3x2">3×2</button>
                    <button onclick="setLayout(2, 3)" data-layout="2x3">2×3</button>
                    <button onclick="setLayout(3, 3)" data-layout="3x3">3×3</button>
                    <button onclick="setLayout(4, 2)" data-layout="4x2">4×2</button>
                    <button onclick="setLayout(2, 4)" data-layout="2x4">2×4</button>
                    <button onclick="setLayout(4, 3)" data-layout="4x3">4×3</button>
                </div>
            </div>
            
            <!-- Custom Grid -->
            <div id="customGrid" class="layout-option" style="display: none;">
                <div class="custom-grid-controls">
                    <div class="grid-input-group">
                        <label for="customCols">
                            📊 Columns:
                            <input type="number" id="customCols" min="1" max="8" value="3" onchange="updateCustomLayout()">
                        </label>
                        <label for="customRows">
                            📈 Rows:
                            <input type="number" id="customRows" min="1" max="8" value="2" onchange="updateCustomLayout()">
                        </label>
                    </div>
                    <p id="customLayoutInfo" class="layout-details"></p>
                </div>
            </div>
        </div>
        
        <!-- Instructions -->
        <div class="instructions" id="instructions" style="display: none;">
            <h3>📋 How to Use</h3>
            <ul>
                <li><strong>📁 Upload</strong> your chart images in any supported format</li>
                <li><strong>📐 Choose layout</strong> or let the tool auto-arrange them</li>
                <li><strong>✏️ Edit labels</strong> by clicking the text fields above</li>
                <li><strong>⚙️ Customize</strong> spacing, fonts, and background below</li>
                <li><strong>🚀 Generate</strong> and download your combined layout</li>
            </ul>
        </div>

        <!-- Interactive Canvas Preview -->
        <div id="canvasSection" style="display: none;">
            <h3>🎨 Interactive Layout Editor</h3>
            <div class="canvas-controls">
                <button onclick="autoArrangeImages()" class="secondary-btn">📐 Auto Arrange</button>
                <button onclick="resetCanvasLayout()" class="secondary-btn">🔄 Reset Layout</button>
                <button onclick="addGridLines()" class="secondary-btn">📏 Toggle Grid</button>
            </div>
            
            <div class="canvas-container-editor">
                <canvas id="layoutCanvas" width="1000" height="600"></canvas>
            </div>
            
            <div class="canvas-instructions">
                <p><strong>💡 How to use:</strong></p>
                <ul>
                    <li><strong>Drag</strong> images to reposition them</li>
                    <li><strong>Drag corners</strong> to resize images</li>
                    <li><strong>Double-click</strong> to edit labels</li>
                    <li><strong>Right-click</strong> to delete images</li>
                </ul>
            </div>
        </div>

        
        <!-- Fallback Preview Area if interactive is not available  -->
        <div id="layoutPreview" style="display: none;">
            <!-- Slots will be generated here -->
        </div>
        
        <!-- Advanced Controls -->
        <div class="advanced-controls" id="advancedControls" style="display: none;">
            <h3>🎨 Customization Options</h3>
            
            <div class="control-row">
                <label>
                    📏 Spacing: 
                    <input type="range" id="spacingSlider" min="5" max="80" value="20">
                    <span id="spacingValue">20px</span>
                </label>
                <label>
                    📝 Font Size: 
                    <input type="range" id="fontSlider" min="12" max="48" value="16">
                    <span id="fontValue">16px</span>
                </label>
            </div>
            
            <div class="control-row">
               <label>
                    🎯 Label Position: 
                    <select id="labelPosition" onchange="updateAllLabelPreviews()">
                        <option value="bottom">Bottom (center)</option>
                        <option value="top">Top (center)</option>
                        <option value="bottom-left">Bottom Left</option>
                        <option value="bottom-right">Bottom Right</option>
                        <option value="top-left">Top Left</option>
                        <option value="top-right">Top Right</option>
                        <option value="left">Left (middle)</option>
                        <option value="right">Right (middle)</option>
                        <option value="overlay">Overlay (bottom center)</option>
                        <option value="none">No Labels</option>
                    </select>
                </label>
                <label>
                    🎨 Background: 
                    <select id="backgroundType">
                        <option value="white">White</option>
                        <option value="transparent">Transparent</option>
                        <option value="light">Light Gray</option>
                        <option value="custom">Custom Color</option>
                    </select>
                    <input type="color" id="customBgColor" value="#ffffff" style="display: none; margin-left: 10px;">
                </label>
            </div>
            
            <div class="control-row">
                <label>
                    🔍 Output Quality: 
                    <select id="qualitySelect">
                        <option value="medium">Medium (800×600/cell) - Web</option>
                        <option value="large" selected>Large (1200×900/cell) - Standard</option>
                        <option value="xlarge">X-Large (1600×1200/cell) - Print</option>
                        <option value="ultra">Ultra (2400×1800/cell) - Archive</option>
                    </select>
                </label>
                <label>
                    📄 PDF DPI: 
                    <select id="pdfDPI">
                        <option value="150">150 DPI (Draft)</option>
                        <option value="300" selected>300 DPI (Print)</option>
                        <option value="600">600 DPI (High-end)</option>
                    </select>
                </label>
            </div>
        </div>
        
        <!-- Controls -->
        <div id="controls" style="display: none;">
            <div class="control-buttons">
                <button onclick="generateImage()" id="generateBtn" class="primary-btn">🚀 Generate Final Image</button>
                <button onclick="clearLayout()" class="secondary-btn">🗑️ Clear Layout</button>
                <button onclick="resetAll()" class="secondary-btn">🔄 Start Over</button>
            </div>
        </div>
        
        <!-- Final Image Preview -->
        <div id="finalImagePreview" style="display: none;">
            <h3>✨ Final Image Preview</h3>
            <div class="canvas-container">
                <canvas id="finalCanvas"></canvas>
            </div>
            
            <!-- Success message with donation -->
            <div class="success-section">
                <h4>🎉 Perfect! Your chart layout is ready!</h4>
                <p>Saved you time? Consider supporting this free tool:</p>
                <a href="https://ko-fi.com/tassio" target="_blank" class="kofi-btn">
                    ☕ Buy me a coffee
                </a>
                <span class="support-text">Every tip helps keep this tool free! 💙</span>
            </div>
            
            <!-- Download Options -->
            <div class="download-options">
                <button onclick="downloadImage('png')" class="download-btn">📥 PNG (Web)</button>
                <button onclick="downloadImage('jpg')" class="download-btn">📥 JPG (Compressed)</button>
                <button onclick="downloadImage('pdf')" class="download-btn">📄 PDF (Print)</button>
                <button onclick="downloadImage('tiff')" class="download-btn">🖼️ TIFF (Archive)</button>
                <button onclick="copyToClipboard()" class="download-btn">📋 Copy to Clipboard</button>
            </div>
        </div>
        
        <!-- Footer -->
        <footer>
            <p>Made with ❤️ for researchers, scientists, and data enthusiasts</p>
            <p><small>Free • Open Source • No Data Collected</small></p>
        </footer>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/utif@3.1.0/UTIF.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
    
    <!-- Main Application -->
    <script src="app.js"></script>
    
    <!-- Ko-fi Floating Widget -->
    <script src='https://storage.ko-fi.com/cdn/scripts/overlay-widget.js'></script>
    <script>
      kofiWidgetOverlay.draw('tassio', {
        'type': 'floating-chat',
        'floating-chat.donateButton.text': 'Support Tool',
        'floating-chat.donateButton.background-color': '#13C3FF',
        'floating-chat.donateButton.text-color': '#fff'
      });
    </script>
</body>
</html>
